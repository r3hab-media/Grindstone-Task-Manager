<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grindstone</title>
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#0b0f14">

  <link rel='stylesheet'
    href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.13.1/font/bootstrap-icons.min.css'
    integrity='sha512-t7Few9xlddEmgd3oKZQahkNI4dS6l80+eGEzFQiqtyVYdvcSG2D3Iub77R20BdotfRPA9caaRkg1tyaJiPmO0g=='
    crossorigin='anonymous' />
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.7/css/bootstrap.min.css'
    integrity='sha512-fw7f+TcMjTb7bpbLJZlP8g2Y4XcCyFZW8uy8HsRZsH/SwbMw0plKHFHr99DN3l04VsYNwvzicUX/6qurvIxbxw=='
    crossorigin='anonymous' />
  <script src='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.7/js/bootstrap.bundle.min.js'
    integrity='sha512-Tc0i+vRogmX4NN7tuLbQfBxa8JkfUSAxSFVzmU31nVdHyiHElPPy2cWfFacmCJKw0VqovrzKhdd2TSTMdAxp2g=='
    crossorigin='anonymous' defer></script>
  <script src="js/app.js" defer></script>
  <link rel="stylesheet" href="css/styles.css">
</head>

<body class="bg-body-tertiary">
  <!-- Header -->
  <nav class="navbar sticky-top border-bottom bg-body">
    <div class="container-fluid g-2">
      <div class="d-flex flex-column">
        <div class="branding">
          <img src="./img/grindstone-logo.png" class="branding__logo" alt="Grindstone Logo">
          <h4 class="fw-bold ms-2">Grindstone</h4>
        </div>
        <h6 id="todayLabel" class="text-secondary"></h6>
      </div>
      <input id="search" type="search" class="form-control w-auto" placeholder="Search title, notes, tags  ⌘/Ctrl+F">
      <div class="d-flex align-items-center gap-3 small">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="fmt" id="fmtMd" value="md" checked>
          <label class="form-check-label" for="fmtMd">Markdown</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="fmt" id="fmtTxt" value="txt">
          <label class="form-check-label" for="fmtTxt">Plain text</label>
        </div>
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="withTimes" checked>
          <label class="form-check-label" for="withTimes">include times</label>
        </div>
      </div>
      <div class="d-flex gap-2">
        <button id="installBtn" class="btn btn-success" hidden>
          <i class="bi bi-download"></i> Install Me!
        </button>
        <button id="closeDay" class="btn btn-warning">Close Day</button>
        <button id="exportBtn" class="btn btn-outline-secondary" title="Export JSON">Export</button>
        <button id="importBtn" class="btn btn-outline-secondary">Import</button>
        <button id="settingsBtn" class="btn btn-outline-secondary">Settings</button>
        <button id="themeBtn" class="btn btn-outline-secondary" type="button" aria-pressed="false" title="Toggle theme">
          <i class="bi bi-moon"></i>
        </button>
      </div>
    </div>
  </nav>

  <!-- Quick add -->
  <div class="container-fluid mt-3">
    <div class="input-group">
      <input id="quick" type="text" class="form-control"
        placeholder='Quick add — e.g.  Send report @ops #q3 ~30m today 3pm   (tip: press "q")'>
      <button id="addBtn" class="btn btn-success">Add</button>
    </div>
    <div class="form-text">/standup /code-review • @tags #project • ~25m • today|tomorrow • 3pm • paste multi-line to
      batch</div>
  </div>

  <!-- Alerts -->
  <div class="container-fluid mt-3" id="warnwrap"></div>

  <!-- Two panes -->
  <div class="container-fluid mt-2">
    <div class="row g-3">
      <!-- Today -->
      <div class="col-lg-6">
        <div class="card shadow-sm">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center gap-2">
              <h6 class="mb-0">Today</h6>
              <span class="badge rounded-pill text-bg-secondary" id="todayCount">0</span>
              <span class="badge rounded-pill text-bg-secondary" id="wipPill" title="In-progress / WIP limit">0/0</span>
              <span class="badge rounded-pill text-bg-secondary" id="estPill" title="Total estimated today">0m</span>
            </div>
            <button id="newBacklog" class="btn btn-sm btn-outline-secondary">Add to backlog</button>
          </div>
          <div class="list-group list-group-flush py-2" id="listToday" data-list="today"></div>
          <div class="card-footer small text-secondary d-flex justify-content-between">
            <div>Drag to reorder. Enter starts, C completes, F focus, D defer.</div>
            <div><span class="mono">q</span> quick add • <span class="mono">⌘/Ctrl+K</span> command palette</div>
          </div>
        </div>
      </div>

      <!-- Done -->
      <div class="col-lg-6">
        <div class="card shadow-sm">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center gap-2">
              <h6 class="mb-0">Done</h6>
              <span class="badge rounded-pill text-bg-secondary" id="doneCount">0</span>
            </div>
            <div class="d-flex gap-2">
              <button id="copyList" class="btn btn-sm btn-outline-secondary" title="Copy current view">Copy</button>
              <button id="clearDone" class="btn btn-sm btn-outline-secondary">Clear done (today)</button>
            </div>
          </div>
          <div class="list-group list-group-flush py-2" id="listDone" data-list="done"></div>
          <div class="card-footer small text-secondary d-flex justify-content-between">
            <div>Close Day stamps times and copies a summary.</div>
            <div><span class="mono">/</span> templates • <span class="mono">#</span> project • <span
                class="mono">@</span> tags</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Event log -->
  <div class="container-fluid mt-3">
    <div class="accordion" id="logAcc">
      <div class="accordion-item">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#logBody">Event log
            (immutable)</button>
        </h2>
        <div id="logBody" class="accordion-collapse collapse" data-bs-parent="#logAcc">
          <div class="accordion-body">
            <div id="events" class="mono small"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Focus modal -->
  <div class="modal fade" id="focusModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="focusTitle"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="closeFocus"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex align-items-center gap-2 mb-2">
            <select id="timerLen" class="form-select w-auto">
              <option value="25">25 min</option>
              <option value="35">35 min</option>
              <option value="45">45 min</option>
              <option value="50">50 min</option>
            </select>
            <button id="toggleTimer" class="btn btn-success">Start</button>
            <div class="ms-auto d-flex align-items-center gap-3">
              <div id="clock" class="display-6 mono mb-0">00:00</div>
              <small id="timerMsg" class="text-secondary"></small>
            </div>
          </div>
          <textarea id="focusNotes" rows="6" class="form-control"
            placeholder="Notes (optional, stored locally)"></textarea>
        </div>
        <div class="modal-footer">
          <button id="saveNotes" class="btn btn-outline-secondary">Save notes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Command palette -->
  <div class="modal fade" id="cmdModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <input id="cmdInput" class="form-control form-control-lg border-0 rounded-0"
          placeholder="Type a command… e.g., close, export, filter @deep, filter #clientA, wip 2, timer 50">
        <div class="list-group list-group-flush" id="cmdItems"></div>
      </div>
    </div>
  </div>

  <!-- Settings modal -->
  <div class="modal fade" id="settingsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Settings</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            id="closeSettings"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">WIP limit</label>
              <input id="wipLimit" type="number" min="1" max="5" class="form-control" value="2">
              <div class="form-text">Max simultaneous “in-progress”. Hard cap.</div>
              <hr>
              <label class="form-label">Available hours today</label>
              <input id="availHours" type="number" min="1" max="16" step=".5" class="form-control" value="6">
              <div class="form-text">Used for time-budget alert.</div>
              <hr>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="bcSync" checked>
                <label class="form-check-label" for="bcSync">Sync across tabs (BroadcastChannel)</label>
              </div>
              <hr>
              <button id="resetApp" class="btn btn-outline-danger">Reset all data</button>
            </div>
            <div class="col-md-6">
              <h6>Optional note encryption</h6>
              <div class="form-text">Notes only. AES-GCM via WebCrypto. Passphrase held in memory per tab.</div>
              <input id="cryptoPass" type="password" class="form-control my-2" placeholder="Set passphrase to enable">
              <div class="d-flex align-items-center gap-2">
                <button id="applyCrypto" class="btn btn-outline-secondary">Apply</button>
                <small id="cryptoStatus"></small>
              </div>
              <hr>
              <h6>Import JSON</h6>
              <input id="filePicker" type="file" class="form-control" accept="application/json">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toasts -->
  <div class="toast-container-fluid position-fixed top-0 start-50 translate-middle-x p-3" id="toastWrap"></div>
</body>

</html>